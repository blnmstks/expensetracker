# üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!

## ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

### 1. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç Login** (`src/components/Login.tsx`)
- –í–∫–ª–∞–¥–∫–∏ "–í—Ö–æ–¥" –∏ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Google OAuth
- –ö—Ä–∞—Å–∏–≤—ã–π UI —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º shadcn/ui

### 2. **API –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (`src/services/api.ts`)
–û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å **allauth.headless**:
```typescript
authAPI.whoami()      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
authAPI.login()       // –í—Ö–æ–¥
authAPI.register()    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
authAPI.logout()      // –í—ã—Ö–æ–¥
authAPI.getSession()  // –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é
authAPI.googleStart() // Google OAuth
```

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ App.tsx**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Login, –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –≤ —Å–∞–π–¥–±–∞—Ä–µ (desktop) –∏ —Ö–µ–¥–µ—Ä–µ (mobile)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–µ–Ω–¥–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:

### 1. **CORS** (`settings.py`):
```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://localhost:3001",
]

CORS_ALLOW_CREDENTIALS = True  # –í–ê–ñ–ù–û –¥–ª—è cookies!
```

### 2. **Session –∏ CSRF**:
```python
CSRF_TRUSTED_ORIGINS = [
    "http://localhost:3000",
    "http://localhost:3001",
]

SESSION_COOKIE_SAMESITE = 'Lax'
CSRF_COOKIE_SAMESITE = 'Lax'
SESSION_COOKIE_SECURE = False  # True —Ç–æ–ª—å–∫–æ –¥–ª—è HTTPS
CSRF_COOKIE_SECURE = False     # True —Ç–æ–ª—å–∫–æ –¥–ª—è HTTPS
```

### 3. **Allauth Headless** –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—É–∂–µ –µ—Å—Ç—å –≤ URLs):
```python
path("api/auth/", include("allauth.headless.urls")),
```

---

## üìù –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```
1. App.tsx –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ /whoami/
2. –ï—Å–ª–∏ user.is_anonymous === false ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ï—Å–ª–∏ user.is_anonymous === true ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º Login
```

### **–ü—Ä–∏ –≤—Ö–æ–¥–µ:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email/password
2. POST /api/auth/login
3. Django —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie
4. Axios –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç CSRF token
5. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
```

### **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞:**
```
1. POST /api/expenses/ (—Å cookies —Å–µ—Å—Å–∏–∏)
2. Django –≤–∏–¥–∏—Ç request.user = CustomUser
3. Expense —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
4. ‚úÖ –£—Å–ø–µ—Ö!
```

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
# .env
VITE_API_URL=http://localhost:8000/api
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:
```bash
npm run dev
```

### 3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```bash
# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
python manage.py runserver
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–Ω–∞ –±—ç–∫–µ–Ω–¥–µ):
```bash
python manage.py createsuperuser
```

### 2. **–ò–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å** —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### 3. **–í–æ–π–¥–∏—Ç–µ** –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Ö–æ–¥

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞ 403 Forbidden:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `withCredentials: true` –≤ axios.ts
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ CSRF cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (DevTools ‚Üí Application ‚Üí Cookies)

### –û—à–∏–±–∫–∞ "AnonymousUser":
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cookies –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∑–∞–ø—Ä–æ—Å–æ–º
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SESSION_COOKIE_SAMESITE –∏ CORS_ALLOW_CREDENTIALS
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Cookie header

### –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç Google OAuth:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Google OAuth –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ redirect_uri –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Django

---

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ Login.tsx              ‚Üê –ù–û–í–´–ô: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ AddExpense.tsx         ‚Üê –û–±–Ω–æ–≤–ª—ë–Ω
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ api.ts                 ‚Üê –û–±–Ω–æ–≤–ª—ë–Ω: authAPI
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ axios.ts               ‚Üê –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (withCredentials)
‚îî‚îÄ‚îÄ App.tsx                    ‚Üê –û–±–Ω–æ–≤–ª—ë–Ω: –ø—Ä–æ–≤–µ—Ä–∫–∞ auth
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚ö†Ô∏è –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø—ã –≤ AddExpense (currency: number vs string)
3. üìù –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ä–∞—Å—Ö–æ–¥—ã —Å –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ
4. üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –±—ç–∫–µ–Ω–¥–∞

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏—é –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
fetch('http://localhost:8000/api/whoami/', { credentials: 'include' })
  .then(r => r.json())
  .then(console.log)
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookies:
```javascript
console.log(document.cookie)
```

### –í—ã–π—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å:
```javascript
fetch('http://localhost:8000/api/auth/session', { 
  method: 'DELETE', 
  credentials: 'include' 
})
```
